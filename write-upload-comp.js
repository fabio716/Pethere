const fs = require("fs");
const code = [
"\"use client\"","",
"import { useState, useRef } from \"react\"","import { Upload, X, Loader2, Image as ImageIcon } from \"lucide-react\"","",
"interface ImageUploadProps {",
"  value: string","  onChange: (url: string) => void","  label?: string","  accept?: string","  placeholder?: string","}","",
"export default function ImageUpload({ value, onChange, label = \"Imagem\", accept = \"image/*\", placeholder = \"Arraste sua imagem aqui ou clique para selecionar\" }: ImageUploadProps) {",
"  const [uploading, setUploading] = useState(false)","  const [preview, setPreview] = useState(value)","  const [dragOver, setDragOver] = useState(false)","  const fileRef = useRef<HTMLInputElement>(null)","",
"  const handleFile = async (file: File) => {",
"    if (!file) return","    setUploading(true)","",
"    // Preview imediato","    const reader = new FileReader()","    reader.onload = (e) => setPreview(e.target?.result as string)","    reader.readAsDataURL(file)","",
"    // Upload para servidor","    const fd = new FormData()","    fd.append(\"file\", file)","    try {","      const res = await fetch(\"/api/upload\", { method: \"POST\", body: fd })","      const data = await res.json()","      if (data.url) { onChange(data.url); setPreview(data.url) }","      else if (data.success && data.logoUrl) { onChange(data.logoUrl); setPreview(data.logoUrl) }","    } catch (err) { console.error(\"Upload failed:\", err) }","    finally { setUploading(false) }","  }","",
"  const handleDrop = (e: React.DragEvent) => {","    e.preventDefault()","    setDragOver(false)","    const file = e.dataTransfer.files[0]","    if (file) handleFile(file)","  }","",
"  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {","    const file = e.target.files?.[0]","    if (file) handleFile(file)","  }","",
"  return (","    <div>","      <label className=\"block text-sm font-medium text-gray-700 mb-2\">{label}</label>","      <input ref={fileRef} type=\"file\" accept={accept} onChange={handleChange} className=\"hidden\" />","",
"      {preview ? (","        <div className=\"relative group\">","          <img src={preview} alt=\"Preview\" className=\"w-full h-40 object-cover rounded-xl border-2 border-gray-200\" />","          <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-2\">","            <button type=\"button\" onClick={() => fileRef.current?.click()} className=\"bg-white text-gray-800 px-3 py-1.5 rounded-lg text-sm font-medium\">Trocar</button>","            <button type=\"button\" onClick={() => { setPreview(\"\"); onChange(\"\") }} className=\"bg-red-500 text-white px-3 py-1.5 rounded-lg text-sm font-medium\">Remover</button>","          </div>","          {uploading && <div className=\"absolute inset-0 bg-black/60 rounded-xl flex items-center justify-center\"><Loader2 className=\"w-8 h-8 text-white animate-spin\" /></div>}","        </div>","      ) : (","        <div","          onDragOver={(e) => { e.preventDefault(); setDragOver(true) }}","          onDragLeave={() => setDragOver(false)}","          onDrop={handleDrop}","          onClick={() => fileRef.current?.click()}","          className={\"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all \" + (dragOver ? \"border-green-500 bg-green-50\" : \"border-gray-300 hover:border-green-500 hover:bg-green-50/50\")}","        >","          {uploading ? (","            <Loader2 className=\"w-8 h-8 text-green-500 animate-spin mx-auto\" />","          ) : (","            <>","              <Upload className=\"w-10 h-10 text-gray-400 mx-auto mb-3\" />","              <p className=\"text-sm text-gray-500 font-medium\">{placeholder}</p>","              <p className=\"text-xs text-gray-400 mt-1\">PNG, JPG, SVG (max 5MB)</p>","            </>","          )}","        </div>","      )}","",
"      {/* URL manual */}","      <input type=\"text\" value={value} onChange={(e) => { onChange(e.target.value); setPreview(e.target.value) }} placeholder=\"Ou cole uma URL: https://...\" className=\"mt-2 w-full px-3 py-2 border border-gray-200 rounded-lg text-sm text-gray-600 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none\" />","    </div>","  )","}"
].join("\n");
fs.writeFileSync("components/ImageUpload.tsx", code, "utf8");
console.log("[OK] components/ImageUpload.tsx criado - drag and drop + preview + URL manual");
