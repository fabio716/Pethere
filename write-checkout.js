const fs = require("fs");
if (!fs.existsSync("app/checkout")) fs.mkdirSync("app/checkout", { recursive: true });
const L = [];
L.push("\"use client\"");
L.push("");
L.push("import { useState, useEffect } from \"react\"");
L.push("import { motion } from \"framer-motion\"");
L.push("import { ArrowLeft, Lock, Shield, CreditCard, QrCode, Check, Truck, AlertCircle, MapPin, Plus, Minus, Loader2, Gift, Zap, Star, User, Building2, Phone, Mail, ChevronRight } from \"lucide-react\"");
L.push("");
L.push("type PersonType = \"PF\" | \"PJ\"");
L.push("type PaymentMethod = \"card\" | \"pix\"");
L.push("");
L.push("interface FormData { personType: PersonType; name: string; document: string; responsibleName: string; whatsapp: string; email: string; cep: string; address: string; number: string; complement: string; neighborhood: string; city: string; state: string }");
L.push("");
L.push("const maskCPF=(v:string)=>{const d=v.replace(/\\D/g,\"\").slice(0,11);return d.replace(/(\\d{3})(\\d)/,\"$1.$2\").replace(/(\\d{3})(\\d)/,\"$1.$2\").replace(/(\\d{3})(\\d{1,2})$/,\"$1-$2\")}");
L.push("const maskCNPJ=(v:string)=>{const d=v.replace(/\\D/g,\"\").slice(0,14);return d.replace(/(\\d{2})(\\d)/,\"$1.$2\").replace(/(\\d{3})(\\d)/,\"$1.$2\").replace(/(\\d{3})(\\d)/,\"$1/$2\").replace(/(\\d{4})(\\d{1,2})$/,\"$1-$2\")}");
L.push("const maskPhone=(v:string)=>{const d=v.replace(/\\D/g,\"\").slice(0,11);if(d.length<=2)return\"(\"+d;if(d.length<=7)return\"(\"+d.slice(0,2)+\") \"+d.slice(2);return\"(\"+d.slice(0,2)+\") \"+d.slice(2,7)+\"-\"+d.slice(7)}");
L.push("const maskCEP=(v:string)=>{const d=v.replace(/\\D/g,\"\").slice(0,8);if(d.length<=5)return d;return d.slice(0,5)+\"-\"+d.slice(5)}");
L.push("");
L.push("export default function CheckoutPage() {");
L.push("  const [form, setForm] = useState<FormData>({ personType:\"PF\",name:\"\",document:\"\",responsibleName:\"\",whatsapp:\"\",email:\"\",cep:\"\",address:\"\",number:\"\",complement:\"\",neighborhood:\"\",city:\"\",state:\"\" })");
L.push("  const [quantity, setQuantity] = useState(1)");
L.push("  const [paymentMethod, setPaymentMethod] = useState<PaymentMethod>(\"card\")");
L.push("  const [orderBump, setOrderBump] = useState(false)");
L.push("  const [submitting, setSubmitting] = useState(false)");
L.push("  const [loadingCep, setLoadingCep] = useState(false)");
L.push("  const [error, setError] = useState(\"\")");
L.push("  const [step, setStep] = useState<\"form\"|\"success\">(\"form\")");
L.push("  const [orderId, setOrderId] = useState(\"\")");
L.push("");
L.push("  const unitPrice=478.80, installments=12, installmentValue=39.90, bumpPrice=19.90, pixDiscount=0.05");
L.push("  const subtotal=unitPrice*quantity");
L.push("  const bumpTotal=orderBump?bumpPrice*quantity:0");
L.push("  const preTotal=subtotal+bumpTotal");
L.push("  const pixSavings=paymentMethod===\"pix\"?preTotal*pixDiscount:0");
L.push("  const total=preTotal-pixSavings");
L.push("");
L.push("  const set=(f:keyof FormData,v:string)=>{setForm(p=>({...p,[f]:v}));setError(\"\")}");
L.push("");
L.push("  useEffect(()=>{const cep=form.cep.replace(/\\D/g,\"\");if(cep.length===8){setLoadingCep(true);fetch(\"https://viacep.com.br/ws/\"+cep+\"/json/\").then(r=>r.json()).then(d=>{if(!d.erro)setForm(p=>({...p,address:d.logradouro||p.address,neighborhood:d.bairro||p.neighborhood,city:d.localidade||p.city,state:d.uf||p.state}))}).catch(()=>{}).finally(()=>setLoadingCep(false))}},[form.cep])");
L.push("");
L.push("  const validate=():boolean=>{");
L.push("    if(!form.name||form.name.length<3){setError(\"Nome obrigat\u00f3rio.\");return false}");
L.push("    if(form.whatsapp.replace(/\\D/g,\"\").length<10){setError(\"WhatsApp inv\u00e1lido.\");return false}");
L.push("    if(!form.email||!form.email.includes(\"@\")){setError(\"Email inv\u00e1lido.\");return false}");
L.push("    const doc=form.document.replace(/\\D/g,\"\")");
L.push("    if(form.personType===\"PF\"&&doc.length!==11){setError(\"CPF inv\u00e1lido.\");return false}");
L.push("    if(form.personType===\"PJ\"&&doc.length!==14){setError(\"CNPJ inv\u00e1lido.\");return false}");
L.push("    if(form.personType===\"PJ\"&&!form.responsibleName){setError(\"Respons\u00e1vel obrigat\u00f3rio.\");return false}");
L.push("    if(form.cep.replace(/\\D/g,\"\").length!==8){setError(\"CEP inv\u00e1lido.\");return false}");
L.push("    if(!form.address){setError(\"Endere\u00e7o obrigat\u00f3rio.\");return false}");
L.push("    if(!form.number){setError(\"N\u00famero obrigat\u00f3rio.\");return false}");
L.push("    if(!form.city||!form.state){setError(\"Cidade/Estado obrigat\u00f3rios.\");return false}");
L.push("    return true}");
L.push("");
L.push("  const handleSubmit=async()=>{");
L.push("    if(!validate())return;setSubmitting(true);setError(\"\")");
L.push("    try{const res=await fetch(\"/api/checkout/create\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({customer_type:form.personType===\"PF\"?\"individual\":\"corporation\",name:form.name,document:form.document.replace(/\\D/g,\"\"),responsible_name:form.responsibleName,whatsapp:form.whatsapp.replace(/\\D/g,\"\"),email:form.email,cep:form.cep.replace(/\\D/g,\"\"),address:form.address,number:form.number,complement:form.complement,neighborhood:form.neighborhood,city:form.city,state:form.state,quantity,payment_method:paymentMethod,order_bump:orderBump,total})})");
L.push("    const data=await res.json()");
L.push("    if(!res.ok){setError(data.error||\"Erro ao processar.\");return}");
L.push("    setOrderId(data.orderNumber||data.id||\"\");setStep(\"success\")");
L.push("    }catch{setError(\"Erro de conex\u00e3o.\")}finally{setSubmitting(false)}}");
L.push("");
L.push("  const ic=\"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 outline-none focus:border-green-500 focus:ring-1 focus:ring-green-500/30 transition text-sm\"");
L.push("  const lc=\"text-sm text-slate-400 mb-1 block font-medium\"");
L.push("");
L.push("  if(step===\"success\")return(");
L.push("    <div className=\"min-h-screen bg-slate-900 flex items-center justify-center p-4\">");
L.push("      <div className=\"max-w-md w-full bg-slate-800 rounded-2xl border border-green-500/30 p-8 text-center\">");
L.push("        <div className=\"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4\"><Check className=\"h-8 w-8 text-white\" /></div>");
L.push("        <h1 className=\"text-2xl font-bold text-white mb-2\">Pedido Confirmado!</h1>");
L.push("        <p className=\"text-slate-400 mb-4\">Pedido #{orderId}</p>");
L.push("        <p className=\"text-sm text-slate-400 mb-6\">Confirma\u00e7\u00e3o enviada por WhatsApp. GPS enviado com frete gr\u00e1tis!</p>");
L.push("        <a href=\"/\" className=\"inline-block bg-green-500 text-white px-6 py-3 rounded-xl font-medium hover:bg-green-400 transition\">Voltar</a>");
L.push("      </div></div>)");
L.push("");
L.push("  return(");
L.push("    <div className=\"min-h-screen bg-slate-900 overflow-x-hidden\">");
L.push("      <header className=\"bg-slate-900 border-b border-slate-800 py-4 sticky top-0 z-30\"><div className=\"max-w-5xl mx-auto px-4 flex items-center justify-between\"><a href=\"/\" className=\"flex items-center gap-2 text-slate-400 hover:text-white transition\"><ArrowLeft className=\"h-5 w-5\" /><span className=\"text-sm\">Voltar</span></a><div className=\"flex items-center gap-2 text-green-400 text-sm font-medium\"><Lock className=\"h-4 w-4\" /><span>Checkout Seguro</span></div></div></header>");
L.push("");
L.push("      <main className=\"max-w-5xl mx-auto px-4 py-6\"><div className=\"grid grid-cols-1 lg:grid-cols-5 gap-8\">");
L.push("        <div className=\"lg:col-span-3 space-y-5\">");
L.push("");
L.push("          {error&&<div className=\"flex items-center gap-2 bg-red-500/10 border border-red-500/30 text-red-400 text-sm px-4 py-3 rounded-xl\"><AlertCircle className=\"h-4 w-4\" />{error}</div>}");
L.push("");
L.push("          {/* PF/PJ TOGGLE */}");
L.push("          <div className=\"flex gap-1 p-1 bg-slate-800 rounded-lg border border-slate-700\">");
L.push("            <button onClick={()=>{set(\"personType\",\"PF\");set(\"document\",\"\")}} className={\"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all \"+(form.personType===\"PF\"?\"bg-green-500/20 text-green-400 border border-green-500/30 shadow-sm\":\"text-slate-500 hover:text-slate-300\")}><User className=\"w-4 h-4\" /> Pessoa F\u00edsica</button>");
L.push("            <button onClick={()=>{set(\"personType\",\"PJ\");set(\"document\",\"\")}} className={\"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all \"+(form.personType===\"PJ\"?\"bg-blue-500/20 text-blue-400 border border-blue-500/30 shadow-sm\":\"text-slate-500 hover:text-slate-300\")}><Building2 className=\"w-4 h-4\" /> Pessoa Jur\u00eddica</button>");
L.push("          </div>");
L.push("");
L.push("          {/* LEAD FIRST */}");
L.push("          <section className=\"bg-slate-800 rounded-xl border border-slate-700 p-5\">");
L.push("            <h2 className=\"text-base font-bold text-white mb-4 flex items-center gap-2\"><User className=\"h-4 w-4 text-green-400\" />{form.personType===\"PF\"?\"Dados Pessoais\":\"Dados da Empresa\"}</h2>");
L.push("            <div className=\"space-y-3\">");
L.push("              <div><label className={lc}>{form.personType===\"PF\"?\"Nome Completo *\":\"Raz\u00e3o Social *\"}</label><input type=\"text\" value={form.name} onChange={e=>set(\"name\",e.target.value)} placeholder={form.personType===\"PF\"?\"Seu nome completo\":\"Raz\u00e3o social\"} className={ic} /></div>");
L.push("              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">");
L.push("                <div><label className={lc}>{form.personType===\"PF\"?\"CPF *\":\"CNPJ *\"}</label><input type=\"text\" value={form.document} onChange={e=>set(\"document\",form.personType===\"PF\"?maskCPF(e.target.value):maskCNPJ(e.target.value))} placeholder={form.personType===\"PF\"?\"000.000.000-00\":\"00.000.000/0000-00\"} className={ic} /></div>");
L.push("                <div><label className={lc}><Phone className=\"w-3 h-3 inline\" /> WhatsApp *</label><input type=\"text\" value={form.whatsapp} onChange={e=>set(\"whatsapp\",maskPhone(e.target.value))} placeholder=\"(11) 99999-9999\" className={ic} /></div>");
L.push("              </div>");
L.push("              {form.personType===\"PJ\"&&<div><label className={lc}>Respons\u00e1vel *</label><input type=\"text\" value={form.responsibleName} onChange={e=>set(\"responsibleName\",e.target.value)} placeholder=\"Nome do respons\u00e1vel\" className={ic} /></div>}");
L.push("              <div><label className={lc}><Mail className=\"w-3 h-3 inline\" /> Email *</label><input type=\"email\" value={form.email} onChange={e=>set(\"email\",e.target.value)} placeholder=\"seu@email.com\" className={ic} /></div>");
L.push("            </div></section>");
L.push("");
L.push("          {/* ENDERECO */}");
L.push("          <section className=\"bg-slate-800 rounded-xl border border-slate-700 p-5\">");
L.push("            <h2 className=\"text-base font-bold text-white mb-4 flex items-center gap-2\"><MapPin className=\"h-4 w-4 text-green-400\" />Endere\u00e7o de Entrega</h2>");
L.push("            <div className=\"space-y-3\">");
L.push("              <div className=\"grid grid-cols-3 gap-3\"><div><label className={lc}>CEP *</label><div className=\"relative\"><input type=\"text\" value={form.cep} onChange={e=>set(\"cep\",maskCEP(e.target.value))} placeholder=\"00000-000\" className={ic} />{loadingCep&&<Loader2 className=\"absolute right-3 top-3.5 h-4 w-4 text-green-500 animate-spin\" />}</div></div><div className=\"col-span-2\"><label className={lc}>Endere\u00e7o *</label><input type=\"text\" value={form.address} onChange={e=>set(\"address\",e.target.value)} placeholder=\"Rua, Av...\" className={ic} /></div></div>");
L.push("              <div className=\"grid grid-cols-4 gap-3\"><div><label className={lc}>N\u00ba *</label><input type=\"text\" value={form.number} onChange={e=>set(\"number\",e.target.value)} placeholder=\"123\" className={ic} /></div><div><label className={lc}>Compl.</label><input type=\"text\" value={form.complement} onChange={e=>set(\"complement\",e.target.value)} placeholder=\"Apto\" className={ic} /></div><div><label className={lc}>Bairro</label><input type=\"text\" value={form.neighborhood} onChange={e=>set(\"neighborhood\",e.target.value)} className={ic} /></div><div><label className={lc}>UF</label><input type=\"text\" value={form.state} onChange={e=>set(\"state\",e.target.value.toUpperCase())} maxLength={2} className={ic+\" uppercase\"} /></div></div>");
L.push("              <div><label className={lc}>Cidade *</label><input type=\"text\" value={form.city} onChange={e=>set(\"city\",e.target.value)} className={ic} /></div>");
L.push("            </div></section>");
L.push("");
L.push("          {/* PAGAMENTO */}");
L.push("          <section className=\"bg-slate-800 rounded-xl border border-slate-700 p-5\">");
L.push("            <h2 className=\"text-base font-bold text-white mb-4\">Pagamento</h2>");
L.push("            <div className=\"grid grid-cols-2 gap-3\">");
L.push("              <button onClick={()=>setPaymentMethod(\"card\")} className={\"flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all \"+(paymentMethod===\"card\"?\"border-green-500 bg-green-500/10 text-green-400\":\"border-slate-700 text-slate-400\")}><CreditCard className=\"h-5 w-5\" /><div className=\"text-left\"><span className=\"font-medium text-sm block\">Cart\u00e3o</span><span className=\"text-xs opacity-70\">12x sem juros</span></div></button>");
L.push("              <button onClick={()=>setPaymentMethod(\"pix\")} className={\"relative flex items-center justify-center gap-2 p-4 rounded-xl border-2 transition-all \"+(paymentMethod===\"pix\"?\"border-green-500 bg-green-500/10 text-green-400\":\"border-slate-700 text-slate-400\")}><QrCode className=\"h-5 w-5\" /><div className=\"text-left\"><span className=\"font-medium text-sm block\">PIX</span><span className=\"text-xs opacity-70\">5% desconto</span></div><span className=\"absolute -top-2 -right-2 bg-yellow-500 text-black text-[10px] font-bold px-2 py-0.5 rounded-full\">-5%</span></button>");
L.push("            </div>");
L.push("            {paymentMethod===\"pix\"&&<div className=\"mt-3 p-3 bg-green-500/10 border border-green-500/20 rounded-xl\"><p className=\"text-sm text-green-400 font-medium flex items-center gap-2\"><Zap className=\"w-4 h-4\" />Desconto PIX: -R$ {pixSavings.toFixed(2).replace(\".\",\",\")}</p></div>}");
L.push("          </section>");
L.push("        </div>");
L.push("");
L.push("        {/* RESUMO */}");
L.push("        <div className=\"lg:col-span-2\"><div className=\"sticky top-20 space-y-4\">");
L.push("          <div className=\"bg-slate-800 rounded-xl border border-slate-700 p-5\">");
L.push("            <h2 className=\"text-base font-bold text-white mb-4\">Resumo</h2>");
L.push("            <div className=\"flex items-start gap-4 mb-4\"><div className=\"w-14 h-14 bg-green-500/10 rounded-xl flex items-center justify-center border border-green-500/20\"><MapPin className=\"h-7 w-7 text-green-400\" /></div><div><h3 className=\"text-white font-medium text-sm\">GPS Pethere G2</h3><p className=\"text-xs text-green-400 font-bold\">Hardware GR\u00c1TIS</p><p className=\"text-xs text-slate-400\">12x R$ 39,90</p></div></div>");
L.push("            <div className=\"flex items-center justify-between py-3 border-t border-slate-700\"><span className=\"text-sm text-slate-400\">Qtd</span><div className=\"flex items-center gap-3\"><button onClick={()=>setQuantity(Math.max(1,quantity-1))} className=\"w-8 h-8 rounded-lg bg-slate-700 flex items-center justify-center text-white hover:bg-slate-600\"><Minus className=\"h-4 w-4\" /></button><span className=\"text-white font-bold\">{quantity}</span><button onClick={()=>setQuantity(Math.min(10,quantity+1))} className=\"w-8 h-8 rounded-lg bg-slate-700 flex items-center justify-center text-white hover:bg-slate-600\"><Plus className=\"h-4 w-4\" /></button></div></div>");
L.push("            <div className=\"py-3 border-t border-slate-700 space-y-1\"><div className=\"flex justify-between text-xs text-slate-500\"><span>Hardware (R$ 497)</span><span className=\"text-green-400 font-bold\">GR\u00c1TIS</span></div><div className=\"flex justify-between text-xs text-slate-500\"><span>App Premium</span><span className=\"text-green-400 font-bold\">GR\u00c1TIS</span></div><div className=\"flex justify-between text-xs text-slate-500\"><span>Frete</span><span className=\"text-green-400 font-bold\">GR\u00c1TIS</span></div></div>");
L.push("            <div className=\"space-y-2 pt-3 border-t border-slate-700\">");
L.push("              <div className=\"flex justify-between text-sm\"><span className=\"text-slate-400\">Servi\u00e7o ({quantity}x)</span><span className=\"text-white\">R$ {subtotal.toFixed(2).replace(\".\",\",\")}</span></div>");
L.push("              {orderBump&&<div className=\"flex justify-between text-sm\"><span className=\"text-yellow-400\">Garantia Blindada</span><span className=\"text-yellow-400\">R$ {bumpTotal.toFixed(2).replace(\".\",\",\")}</span></div>}");
L.push("              {paymentMethod===\"pix\"&&<div className=\"flex justify-between text-sm\"><span className=\"text-green-400\">PIX -5%</span><span className=\"text-green-400\">-R$ {pixSavings.toFixed(2).replace(\".\",\",\")}</span></div>}");
L.push("              <div className=\"flex justify-between pt-2 border-t border-slate-700\"><span className=\"text-white font-bold\">Total</span><div className=\"text-right\">{paymentMethod===\"pix\"&&<span className=\"text-sm text-slate-500 line-through block\">R$ {preTotal.toFixed(2).replace(\".\",\",\")}</span>}<span className=\"text-green-400 font-bold text-xl\">R$ {total.toFixed(2).replace(\".\",\",\")}</span></div></div>");
L.push("              {paymentMethod===\"card\"&&<p className=\"text-xs text-slate-500 text-right\">ou 12x R$ {(total/12).toFixed(2).replace(\".\",\",\")}</p>}");
L.push("            </div></div>");
L.push("");
L.push("          {/* ORDER BUMP */}");
L.push("          <div onClick={()=>setOrderBump(!orderBump)} className={\"rounded-xl p-4 border-2 border-dashed cursor-pointer transition-all \"+(orderBump?\"bg-yellow-500/10 border-yellow-500/50\":\"bg-yellow-500/5 border-yellow-500/20 hover:border-yellow-500/40\")}>");
L.push("            <div className=\"flex items-start gap-3\"><div className={\"w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 mt-0.5 transition \"+(orderBump?\"bg-yellow-500 border-yellow-500\":\"border-yellow-500/50\")}>{orderBump&&<Check className=\"w-3 h-3 text-black\" />}</div><div><p className=\"text-sm font-bold text-yellow-400 flex items-center gap-1\"><Star className=\"w-3 h-3\" /> Garantia Blindada (+12 Meses)</p><p className=\"text-xs text-slate-400 mt-1\">Troca imediata por apenas <strong className=\"text-yellow-400\">R$ 19,90</strong></p></div></div></div>");
L.push("");
L.push("          {/* CTA */}");
L.push("          <button onClick={handleSubmit} disabled={submitting} className=\"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-500/20 flex items-center justify-center gap-2 transition-all disabled:opacity-50 text-lg\">{submitting?<><Loader2 className=\"h-5 w-5 animate-spin\" />Processando...</>:<><Lock className=\"h-5 w-5\" />FINALIZAR PEDIDO SEGURO</>}</button>");
L.push("");
L.push("          <div className=\"flex items-center justify-center gap-4 text-xs text-slate-500 flex-wrap\"><span className=\"flex items-center gap-1\"><Shield className=\"h-3 w-3\" />Pagar.me</span><span className=\"flex items-center gap-1\"><Truck className=\"h-3 w-3\" />Frete Gr\u00e1tis</span><span className=\"flex items-center gap-1\"><Gift className=\"h-3 w-3\" />Hardware Gr\u00e1tis</span><span className=\"flex items-center gap-1\"><Check className=\"h-3 w-3\" />Garantia 24m</span></div>");
L.push("        </div></div>");
L.push("      </div></main></div>)");
L.push("}");

fs.writeFileSync("app/checkout/page.tsx", L.join("\n"), "utf8");
console.log("[OK] Checkout criado:", L.length, "linhas");
console.log("Acesse: localhost:3000/checkout");
